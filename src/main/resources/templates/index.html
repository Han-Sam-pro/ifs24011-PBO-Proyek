<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Alarm Clock</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- GLOBAL & LAYOUT --- */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        .container { max-width: 1200px; }
        footer { margin-top: 40px; color: rgba(255, 255, 255, 0.7); text-align: center; font-size: 0.9rem; padding-bottom: 20px; }
        
        /* --- CARDS --- */
        .card {
            border-radius: 15px; border: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px; overflow: hidden;
        }
        .card-header { font-weight: 600; padding: 15px 20px; }
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; color: white; padding: 10px 20px;
            border-radius: 8px; font-weight: 500; transition: all 0.3s ease;
        }
        .btn-custom:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); color: white; }

        /* --- CLOCK --- */
        .clock-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px; padding: 30px; margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center;
        }
        .digital-clock {
            font-family: 'Courier New', monospace; font-size: 4.5rem;
            font-weight: bold; color: #fff;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4); margin: 20px 0;
        }
        .current-date { font-size: 1.2rem; color: rgba(255, 255, 255, 0.8); }

        /* --- ALARM LIST --- */
        .alarm-item {
            border-left: 5px solid #28a745; margin-bottom: 15px; padding: 20px;
            background: #f8f9fa; border-radius: 10px; transition: all 0.3s ease;
        }
        .alarm-item:hover { transform: translateX(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .alarm-item.inactive { border-left-color: #6c757d; opacity: 0.7; }
        
        .alarm-time { font-size: 2rem; font-weight: bold; color: #333; font-family: 'Courier New', monospace; }
        .alarm-label { font-size: 1.1rem; color: #555; word-wrap: break-word; font-weight: 500; }
        
        .alarm-logo {
            width: 45px; height: 45px; object-fit: cover;
            border-radius: 50%; border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15); margin-right: 15px;
        }
        .alarm-image-large {
            margin-top: 12px; max-width: 100%; height: auto;
            max-height: 220px; border-radius: 8px;
            object-fit: cover; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: block;
        }

        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .status-active { background-color: #d4edda; color: #155724; }
        .status-inactive { background-color: #e9ecef; color: #6c757d; }
        .btn-action { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 5px; }

        /* --- AUDIO PLAYER --- */
        .audio-player-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px; padding: 20px; margin-top: 20px;
        }
        .audio-controls { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .audio-btn {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; transition: transform 0.2s; color: white;
        }
        .audio-btn:hover { transform: scale(1.1); }
        .btn-play { background: #28a745; }
        .btn-pause { background: #ffc107; color: #333; }
        .btn-stop { background: #dc3545; }
        .btn-test { background: #17a2b8; }

        /* --- MODALS --- */
        .modal-alarm {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white; border: none; animation: pulse 1.5s infinite;
        }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 9999; animation: slideIn 0.3s ease; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,107,107,0.7); } 70% { box-shadow: 0 0 0 20px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes ring { 0%, 50%, 100% { transform: rotate(0deg); } 25% { transform: rotate(15deg); } 75% { transform: rotate(-15deg); } }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="text-center mb-4">
            <h1 class="text-white mb-2"><i class="bi bi-alarm-fill" aria-hidden="true"></i> Web Alarm Clock</h1>
            <p class="text-white-50">Aplikasi alarm berbasis web dengan Spring Boot</p>
        </div>
        
        <!-- CLOCK DISPLAY -->
        <div class="clock-container">
            <div class="digital-clock" id="digitalClock" th:text="${currentTime}">00:00:00</div>
            <div class="current-date" id="currentDate">Memuat tanggal...</div>
        </div>
        
        <!-- MAIN CONTENT ROW -->
        <div class="row">
            
            <!-- LEFT COLUMN: FORM & AUDIO -->
            <div class="col-lg-4">
                
                <!-- CARD: CREATE ALARM -->
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-plus-circle me-2" aria-hidden="true"></i>Set Alarm Baru
                    </div>
                    <div class="card-body p-4">
                        <form th:action="@{/save}" th:object="${alarmDto}" method="post" enctype="multipart/form-data">
                            
                            <div class="mb-3">
                                <label for="inputAlarmTime" class="form-label fw-bold">Waktu Alarm</label>
                                <input type="time" id="inputAlarmTime" class="form-control" th:field="*{alarmTime}" required
                                       th:classappend="${#fields.hasErrors('alarmTime')} ? 'is-invalid' : ''">
                                <div class="invalid-feedback" th:errors="*{alarmTime}"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="inputLabel" class="form-label fw-bold">Label</label>
                                <input type="text" id="inputLabel" class="form-control" th:field="*{label}" placeholder="Contoh: Rapat, Makan Siang" required>
                            </div>

                            <div class="mb-3">
                                <label for="inputImage" class="form-label fw-bold">Gambar / Logo (Opsional)</label>
                                <input type="file" id="inputImage" class="form-control" name="imageFile" accept="image/*">
                                <div class="form-text">Format didukung: JPG, PNG.</div>
                            </div>

                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="isLogo" th:field="*{isLogo}">
                                <label class="form-check-label" for="isLogo">Tampilkan sebagai Logo kecil</label>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="active" th:field="*{active}" checked>
                                <label class="form-check-label" for="active">Aktifkan Alarm</label>
                            </div>
                            
                            <button type="submit" class="btn btn-custom w-100 mt-2">
                                <i class="bi bi-save me-2" aria-hidden="true"></i>Simpan Alarm
                            </button>
                        </form>

                        <div th:if="${successMessage}" class="alert alert-success mt-3 py-2">
                            <i class="bi bi-check-circle me-2" aria-hidden="true"></i> <span th:text="${successMessage}"></span>
                        </div>
                        <div th:if="${errorMessage}" class="alert alert-danger mt-3 py-2">
                            <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i> <span th:text="${errorMessage}"></span>
                        </div>
                    </div>
                </div>
                
                <!-- CARD: AUDIO PLAYER -->
                <div class="audio-player-section">
                    <h6 class="fw-bold mb-3"><i class="bi bi-music-note-beamed me-2" aria-hidden="true"></i>Pengaturan Suara</h6>
                    <div class="mb-3">
                        <select class="form-select" id="audioSelect" aria-label="Pilih Suara Alarm">
                            <option th:each="audio : ${audioFiles}" th:value="'/Sound/' + ${audio}" th:text="${audio}">Sound</option>
                            <option th:if="${#lists.isEmpty(audioFiles)}" value="/Sound/Yo-Phone-Long.mp3">Default Sound</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label for="volumeSlider" class="form-label small">Volume: <span id="volumeValue">70</span>%</label>
                        <input type="range" class="form-range" id="volumeSlider" min="0" max="100" value="70">
                    </div>
                    <div class="audio-controls justify-content-center">
                        <button class="audio-btn btn-play" onclick="AudioController.play()" title="Putar"><i class="bi bi-play-fill"></i></button>
                        <button class="audio-btn btn-pause" onclick="AudioController.pause()" title="Jeda"><i class="bi bi-pause-fill"></i></button>
                        <button class="audio-btn btn-stop" onclick="AudioController.stop()" title="Stop"><i class="bi bi-stop-fill"></i></button>
                        <button class="audio-btn btn-test" onclick="AudioController.test()" title="Test"><i class="bi bi-bell-fill"></i></button>
                    </div>
                    <div class="text-center mt-3">
                        <small class="text-muted d-block" id="currentAudio">Siap memutar</small>
                        <small class="fw-bold" id="audioStatus">Status: Stopped</small>
                    </div>
                </div>
            </div>
            
            <!-- RIGHT COLUMN: ALARM LIST & CHART -->
            <div class="col-lg-8">
                
                <!-- 1. ALARM LIST CARD -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-list-ul me-2" aria-hidden="true"></i>Daftar Alarm</span>
                        <span class="badge bg-white text-success" th:text="${alarms != null ? alarms.size() : 0}">0</span>
                    </div>
                    <div class="card-body bg-light">
                        
                        <div th:if="${#lists.isEmpty(alarms)}" class="text-center py-5 text-muted">
                            <i class="bi bi-alarm" style="font-size: 3rem;" aria-hidden="true"></i>
                            <p class="mt-2">Belum ada alarm yang diatur.</p>
                        </div>
                        
                        <div th:each="alarm : ${alarms}">
                            <div class="alarm-item" 
                                 th:classappend="${not alarm.active} ? 'inactive' : ''"
                                 th:data-id="${alarm.id}"
                                 th:data-image="${alarm.imageUrl}"
                                 th:data-logo="${alarm.isLogo}">
                                 
                                <div class="row align-items-center">
                                    <div class="col-md-3 text-center text-md-start">
                                        <div class="alarm-time" th:text="${#temporals.format(alarm.alarmTime, 'HH:mm')}">00:00</div>
                                    </div>
                                    
                                    <div class="col-md-5">
                                        <div class="d-flex flex-column">
                                            <div class="d-flex align-items-center mb-1">
                                                <img th:if="${alarm.isLogo and alarm.imageUrl != null}" 
                                                     th:src="${alarm.imageUrl}" class="alarm-logo" alt="Logo Alarm">
                                                <span class="alarm-label" th:text="${alarm.label}">Label</span>
                                            </div>
                                            <div th:if="${!alarm.isLogo and alarm.imageUrl != null}">
                                                <img th:src="${alarm.imageUrl}" class="alarm-image-large" alt="Gambar Kegiatan">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="d-flex justify-content-between align-items-center mt-3 mt-md-0">
                                            <span th:if="${alarm.active}" class="status-badge status-active"><i class="bi bi-check-circle me-1"></i>Aktif</span>
                                            <span th:unless="${alarm.active}" class="status-badge status-inactive"><i class="bi bi-dash-circle me-1"></i>Mati</span>
                                            
                                            <div class="d-flex">
                                                <button type="button" class="btn btn-outline-warning btn-action" th:onclick="'UIController.openEdit(' + ${alarm.id} + ')'" title="Edit">
                                                    <i class="bi bi-pencil-fill"></i>
                                                </button>
                                                <form th:action="@{/toggle/{id}(id=${alarm.id})}" method="post" style="display:inline;">
                                                    <button type="submit" class="btn btn-outline-primary btn-action" th:title="${alarm.active} ? 'Matikan' : 'Hidupkan'">
                                                        <i class="bi" th:class="${alarm.active} ? 'bi-power' : 'bi-play-fill'"></i>
                                                    </button>
                                                </form>
                                                <form th:action="@{/delete/{id}(id=${alarm.id})}" method="post" onsubmit="return confirm('Hapus alarm?');" style="display:inline;">
                                                    <button type="submit" class="btn btn-outline-danger btn-action" title="Hapus">
                                                        <i class="bi bi-trash-fill"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>

                <!-- 2. CARD DIAGRAM CHART (DIPINDAHKAN KE BAWAH) -->
                <div class="card" id="chartCard" th:style="${#lists.isEmpty(alarms)} ? 'display:none;' : ''">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-pie-chart-fill me-2"></i>Statistik Aktivitas Pengguna
                    </div>
                    <div class="card-body bg-white" style="position: relative; height: 350px; display: flex; justify-content: center;">
                        <canvas id="activityChart"></canvas>    
                    </div>
                </div>

            </div>
        </div>
        
        <footer>Web Alarm Clock &copy; 2025 | Built with Spring Boot</footer>
    </div>
    
    <!-- MODAL: ALARM RINGING -->
    <div class="modal fade" id="alarmModal" data-bs-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-alarm">
                <div class="modal-body text-center py-5">
                    <i class="bi bi-alarm-fill mb-3 d-block" style="font-size: 5rem; animation: ring 0.5s infinite;"></i>
                    <h1 class="display-3 fw-bold" id="ringTime">00:00</h1>
                    <h3 class="fw-light mb-4" id="ringLabel">Alarm!</h3>
                    <div class="d-flex justify-content-center gap-3">
                        <button class="btn btn-light btn-lg px-4" onclick="AlarmController.stop()">
                            <i class="bi bi-stop-circle-fill me-2"></i>Matikan
                        </button>
                        <button class="btn btn-outline-light btn-lg px-4" onclick="AlarmController.snooze()">
                            <i class="bi bi-clock-history me-2"></i>Snooze (5m)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL: EDIT ALARM -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Edit Alarm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form th:action="@{/update}" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <input type="hidden" id="editId" name="id">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="editTime" class="form-label">Waktu</label>
                                <input type="time" class="form-control" id="editTime" name="alarmTime" required>
                            </div>
                            <div class="col-12">
                                <label for="editLabel" class="form-label">Label</label>
                                <input type="text" class="form-control" id="editLabel" name="label" required>
                            </div>
                            <div class="col-12 text-center" id="editPreviewContainer" style="display:none;">
                                <div class="p-2 border rounded bg-light">
                                    <small class="d-block text-muted mb-1">Gambar Saat Ini:</small>
                                    <img id="editImagePreview" src="" alt="Preview Gambar" style="height: 100px; max-width: 100%; object-fit: contain;">
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="editImageFile" class="form-label">Ganti Gambar (Opsional)</label>
                                <input type="file" class="form-control" id="editImageFile" name="imageFile" accept="image/*">
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="editIsLogo" name="isLogo" value="true">
                                    <label class="form-check-label" for="editIsLogo">Tampilkan sebagai Logo kecil</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="editActive" name="active" value="true">
                                    <label class="form-check-label" for="editActive">Aktifkan Alarm</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-warning">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <audio id="mainAudio" loop></audio>
    <audio id="previewAudio"></audio>
    
    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const AppState = {
            userInteracted: false,
            lastTriggered: null,
            snoozeTime: null,
            elements: {
                audioMain: document.getElementById('mainAudio'),
                audioPreview: document.getElementById('previewAudio'),
                audioSelect: document.getElementById('audioSelect'),
                volumeSlider: document.getElementById('volumeSlider')
            }
        };

        const Utils = {
            showNotification: (msg) => {
                const div = document.createElement('div');
                div.className = 'alert alert-info notification';
                div.innerHTML = `<i class="bi bi-info-circle-fill me-2"></i>${msg}`;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 4000);
            },
            unlockAudio: () => {
                if (!AppState.userInteracted) {
                    AppState.userInteracted = true;
                    new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==").play().catch(()=>{});
                }
            }
        };

        const AudioController = {
            init: () => {
                AppState.elements.volumeSlider.addEventListener('input', (e) => {
                    const vol = e.target.value / 100;
                    AppState.elements.audioMain.volume = vol;
                    AppState.elements.audioPreview.volume = vol;
                    document.getElementById('volumeValue').textContent = e.target.value;
                });
            },
            play: () => {
                Utils.unlockAudio();
                const src = AppState.elements.audioSelect.value;
                const audio = AppState.elements.audioMain;
                audio.src = src;
                audio.currentTime = 0;
                audio.play()
                    .then(() => AudioController.updateStatus('Playing'))
                    .catch(e => console.error("Audio error:", e));
                document.getElementById('currentAudio').textContent = "Memutar: " + AppState.elements.audioSelect.options[AppState.elements.audioSelect.selectedIndex].text;
            },
            pause: () => {
                AppState.elements.audioMain.pause();
                AppState.elements.audioPreview.pause();
                AudioController.updateStatus('Paused');
            },
            stop: () => {
                AppState.elements.audioMain.pause();
                AppState.elements.audioMain.currentTime = 0;
                AppState.elements.audioPreview.pause();
                AppState.elements.audioPreview.currentTime = 0;
                AudioController.updateStatus('Stopped');
            },
            test: () => {
                Utils.unlockAudio();
                const src = AppState.elements.audioSelect.value;
                AppState.elements.audioPreview.src = src;
                AppState.elements.audioPreview.currentTime = 0;
                AppState.elements.audioPreview.play();
                AudioController.updateStatus('Testing...');
            },
            updateStatus: (status) => {
                document.getElementById('audioStatus').textContent = `Status: ${status}`;
            }
        };

        const AlarmController = {
            check: (currentTime) => {
                document.querySelectorAll('.alarm-item:not(.inactive) .alarm-time').forEach(el => {
                    const time = el.textContent.trim();
                    if (time === currentTime && AppState.lastTriggered !== currentTime) {
                        AppState.lastTriggered = currentTime;
                        const label = el.closest('.alarm-item').querySelector('.alarm-label').textContent.trim();
                        AlarmController.trigger(time, label);
                        setTimeout(() => AppState.lastTriggered = null, 60000);
                    }
                });

                if (AppState.snoozeTime) {
                    const now = new Date();
                    if (now >= AppState.snoozeTime) {
                        const h = String(now.getHours()).padStart(2,'0');
                        const m = String(now.getMinutes()).padStart(2,'0');
                        AlarmController.trigger(`${h}:${m}`, 'Snooze Alarm');
                        AppState.snoozeTime = null;
                    }
                }
            },
            trigger: (time, label) => {
                document.getElementById('ringTime').textContent = time;
                document.getElementById('ringLabel').textContent = label;
                new bootstrap.Modal(document.getElementById('alarmModal')).show();
                AudioController.play();
            },
            stop: () => {
                AudioController.stop();
                bootstrap.Modal.getInstance(document.getElementById('alarmModal')).hide();
            },
            snooze: () => {
                AudioController.stop();
                bootstrap.Modal.getInstance(document.getElementById('alarmModal')).hide();
                AppState.snoozeTime = new Date(Date.now() + 5 * 60000); 
                Utils.showNotification('Alarm ditunda selama 5 menit.');
            }
        };

        const UIController = {
            updateClock: () => {
                const now = new Date();
                const h = String(now.getHours()).padStart(2,'0');
                const m = String(now.getMinutes()).padStart(2,'0');
                const s = String(now.getSeconds()).padStart(2,'0');
                
                document.getElementById('digitalClock').textContent = `${h}:${m}:${s}`;
                document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
                });
                
                AlarmController.check(`${h}:${m}`);
                requestAnimationFrame(UIController.updateClock);
            },
            openEdit: (id) => {
                const item = document.querySelector(`.alarm-item[data-id="${id}"]`);
                if (!item) return;

                document.getElementById('editId').value = id;
                document.getElementById('editTime').value = item.querySelector('.alarm-time').textContent.trim();
                document.getElementById('editLabel').value = item.querySelector('.alarm-label').textContent.trim();
                
                const isActive = !item.classList.contains('inactive');
                const isLogo = item.getAttribute('data-logo') === 'true';
                document.getElementById('editActive').checked = isActive;
                document.getElementById('editIsLogo').checked = isLogo;

                const imgUrl = item.getAttribute('data-image');
                const previewContainer = document.getElementById('editPreviewContainer');
                if (imgUrl && imgUrl !== 'null' && imgUrl !== '') {
                    previewContainer.style.display = 'block';
                    document.getElementById('editImagePreview').src = imgUrl;
                } else {
                    previewContainer.style.display = 'none';
                }

                new bootstrap.Modal(document.getElementById('editModal')).show();
            },
            // Fungsi baru untuk inisialisasi diagram Chart.js
            initChart: () => {
                // 1. Ambil semua elemen label dari daftar alarm
                const labelElements = document.querySelectorAll('.alarm-label');
                
                // Jika tidak ada alarm, sembunyikan chart
                if (labelElements.length === 0) {
                    const chartCard = document.getElementById('chartCard');
                    if(chartCard) chartCard.style.display = 'none';
                    return;
                }

                // 2. Hitung frekuensi setiap label
                const labelCounts = {};
                labelElements.forEach(el => {
                    // Ambil teks, ubah ke lowercase agar konsisten
                    let text = el.textContent.trim();
                    // Kapitalisasi huruf pertama agar rapi di chart
                    text = text.charAt(0).toUpperCase() + text.slice(1);
                    
                    if (labelCounts[text]) {
                        labelCounts[text]++;
                    } else {
                        labelCounts[text] = 1;
                    }
                });

                const labels = Object.keys(labelCounts);
                const data = Object.values(labelCounts);

                // 3. Siapkan Palet Warna yang Berbeda-beda
                // Daftar warna cerah/pastel yang enak dilihat
                const baseColors = [
                    '#FF6384', // Merah Muda
                    '#36A2EB', // Biru
                    '#FFCE56', // Kuning
                    '#4BC0C0', // Tosca
                    '#9966FF', // Ungu
                    '#FF9F40', // Oranye
                    '#C9CBCF', // Abu-abu
                    '#28a745', // Hijau (Tema)
                    '#E83E8C', // Pink Tua
                    '#20C997'  // Hijau Laut
                ];
                
                // Ambil warna sebanyak jumlah label
                // Jika label lebih banyak dari warna, ulangi warnanya
                const backgroundColors = labels.map((_, index) => baseColors[index % baseColors.length]);

                // 4. Render Chart
                const ctx = document.getElementById('activityChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut', // Gunakan 'pie' jika ingin lingkaran penuh
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            hoverOffset: 10, // Efek membesar saat di-hover
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: { size: 14 }
                                }
                            },
                            // Konfigurasi Tooltip agar menampilkan jumlah saat ditekan/hover
                            tooltip: {
                                enabled: true,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        let value = context.raw || 0;
                                        // Format tampilan: "Makan: 3 Alarm"
                                        return ` ${label}: ${value} Alarm`;
                                    }
                                },
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleFont: { size: 16 },
                                bodyFont: { size: 14 },
                                padding: 12,
                                displayColors: true
                            }
                        }
                    }
                });
            }
        };

        /**
         * Initialization
         */
        document.addEventListener('DOMContentLoaded', () => {
            UIController.updateClock();
            AudioController.init();
            UIController.initChart(); // Panggil fungsi chart

            ['click', 'keydown', 'touchstart'].forEach(evt => 
                document.addEventListener(evt, Utils.unlockAudio, {once: true})
            );

            console.log('Alarm Clock Initialized');
        });

    </script>
</body>
</html>